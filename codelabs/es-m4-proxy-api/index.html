
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>M4: Proxy del API Omni Canal</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="es-m4-proxy-api"
                  title="M4: Proxy del API Omni Canal"
                  environment="web"
                  feedback-link="https://github.com/fcatae">
    
      <google-codelab-step label="Vaya al Administrador de API" duration="0">
        <ol type="1" start="1">
<li>en Anypoint Platform (<a href="https://anypoint.mulesoft.com/" target="_blank">https://anypoint.mulesoft.com</a>), haga clic en el icono <strong>API Manager</strong> para comenzar a gestionar su API.<br><img alt="module 5 lab 1 click apimanager" style="width: 838.50px" src="img/1ee16e26e9f6a746.png"></li>
<li>También puede hacer clic en el botón de navegación en la parte superior izquierda, luego en API Manager.<br><img alt="module 5 lab 1 ap navigationLeft" style="width: 406.00px" src="img/d76e60fe85299cc9.png"><br><br><img alt="module 5 lab 1 ap navigation apimanager" style="width: 305.00px" src="img/eb42c408333ef80.png"></li>
<li>seleccione SANDBOX como entorno</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Configurar un proxy API" duration="0">
        <p>Para esta práctica de laboratorio, configuraremos la API como un proxy para la implementación simulada de la API Omni Channel de Mythical Corporation. La API está disponible como una API Restful HTTP accesible a través de la URL base <a href="http://workshop-omni-channel-mock-service-v40.cloudhub.io/api" target="_blank">http://workshop-omni-channel-mock-service-v40.cloudhub.io/api</a>.</p>
<p>Para crear el proxy vamos a obtener la Definición de API de Exchange.</p>
<ol type="1" start="1">
<li>Ahora configuremos una puerta de enlace de proxy API para esta API. De vuelta en la página de administración de API, haga clic en <strong>Manage API</strong> y seleccione <strong>Manage API From Exchange<br></strong><img alt="module 5 lab 1 ap apimanager configureEndpoint" style="width: 812.50px" src="img/315594391e31f1be.png"></li>
<li>Configurar la API con la siguiente información:</li>
</ol>
<ol type="1" start="1">
<li><strong>API Name</strong>I:<code>Experiencia</code> <code>Omni Canal</code>.Observe que cuando comienza a escribir el nombre, el campo se completa automáticamente.</li>
<li><strong>Asset Type</strong>: seleccione de la lista desplegable <code>RAML/OAS</code>.</li>
<li><strong>API Version</strong>: seleccione de la lista desplegable <code>1.0.0</code>.</li>
<li><strong>Asset Version</strong>: seleccione de la lista desplegable <code>1.0.0</code>.</li>
<li><strong>Managing type</strong>: seleccione <code>Endpoint with proxy</code></li>
<li><strong>Proxy Deployment target</strong>: elija <code>Cloudhub</code></li>
<li><strong>Mule Version</strong>: marque la casilla. Vamos a desplegar un Mule 4 Gateway.</li>
<li><strong>Implementation URI</strong>: <a href="http://workshop-omni-channel-mock-service-v40.cloudhub.io/api" target="_blank"><code>http://workshop-omni-channel-mock-service-v40.cloudhub.io/api</code></a></li>
<li><strong>Path</strong>: <code>/<br></code><img alt="module 5 lab 1 api manager confgured" style="width: 738.50px" src="img/c497ab1581ea5809.png"></li>
</ol>
<ol type="1" start="3">
<li>Presione <strong>Advanced Options</strong> y configure:</li>
</ol>
<ol type="1" start="1">
<li><strong>Proxy application name</strong>: <code>&lt;nombre de usuario&gt; -proxy-omni-channel</code>. Este parámetro se utilizará para identificar la API en el Administrador de API.</li>
</ol>
<ol type="1" start="4">
<li>Presione <strong>Save<br></strong>Después de presionar <strong>Save</strong> , aparecerá la sección de configuración de implementación para implementar el proxy.<br><img alt="module 5 lab1 api deployment config" style="width: 847.50px" src="img/5432e49dc101d38b.png"></li>
<li>Configure con la siguiente información:</li>
</ol>
<ol type="1" start="1">
<li><strong>Runtime Version</strong>: Seleccione <code>4.3.0</code></li>
<li><strong>Proxy application Name</strong>: <code>&lt;nombre de usuario&gt; -proxy-omni-channel</code>. Esta propiedad definirá la URL del proxy y el nombre de la aplicación Mule en <strong>Runtime Manager</strong>.</li>
</ol>
<ol type="1" start="6">
<li>Presione el botón <strong>Deploy</strong>.</li>
<li>Debería ver el verde Implementación exitosa en la barra de estado.</li>
<li>Haga clic en <strong>Close</strong>.<br><img alt="module 5 lab 1 ap apimanager deployment" style="width: 710.50px" src="img/46574177ac6653bc.png"></li>
<li>Una vez implementada, en la parte superior de la página verá el estado de la API. Debe ser verde con una bola verde al lado, como se muestra a continuación. Esto indica que su API se implementó correctamente y ahora se está administrando.<br><img alt="module 5 lab 1 ap apimanager proxypanel" style="width: 832.50px" src="img/4c8c548d51209d33.png"></li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Aplicar políticas" duration="0">
        <p>Para probar la administración de políticas, agregará una Política <strong>Rate limiting </strong> sobre  la API.</p>
<ol type="1" start="1">
<li>Vaya a la página de administración de la API de Omni Channel.</li>
<li>Haga clic en la pestaña Políticas debajo de las definiciones de API.<br><img alt="module5 lab2 ap apimanager policies" style="width: 845.50px" src="img/368551f49dd5987.png"></li>
<li>Haga clic en el botón <strong>Apply new policy</strong>.<br><img alt="module5 lab2 ap apimanager policies applyRateLimiting1" style="width: 827.50px" src="img/3a953d23b4dc1.png"></li>
<li>Haga clic en la política de rate limiting, seleccione la versión y <strong>Configure policy</strong>.<br><img alt="module5 lab2 ap apimanager policies applyRateLimiting2" style="width: 781.50px" src="img/4e99a507b9d832b3.png"></li>
<li>Ingrese un máximo de solicitudes de 3 por 1 minuto como se muestra y haga clic en <strong>Apply</strong>.<br><img alt="module5 lab2 ap apimanager policies configRateLimiting" style="width: 789.50px" src="img/544fdfbb4d64cc63.png"></li>
<li>Debería ver la política de limitación de tarifas ahora en Políticas aplicadas.<br><img alt="module 5 lab2 ap apimanager appliedPolicy ratelimiting" style="width: 737.50px" src="img/93e2b91acb0a4e27.png"></li>
<li>Espere un minuto (API Gateway recibe actualizaciones de políticas cada 60 segundos de forma predeterminada). También puede verificar que su API haya recibido la nueva política mirando los registros. Busque en la pestaña de registros en <strong>Runtime Manager</strong> para su aplicación. Busque mensajes de registro similares a los siguientes <strong>com.mulesoft.module.policies.</strong>:<br><img alt="module5 lab2 select runtime manager" style="width: 725.50px" src="img/b12eac003f799888.png"><br><br><img alt="module 5 lab 1a logs" style="width: 753.83px" src="img/44c647bce5bf504a.png"></li>
<li>Pruebe la API usando Postman o cualquier otra herramienta de prueba de API y acceda a su URL de proxy agregando<strong> /products/search</strong> al final (por ejemplo, http: // &lt;nombredeusuario&gt; -proxy-omni-channel.us-e2.cloudhub.io/products/search ).<br><img alt="module 5 lab2 browser json response ratelimiting" style="width: 864.50px" src="img/24bb56cfd7c24e72.png"></li>
<li>Pruébelo nuevamente presionando el <strong>Send</strong> botón <strong>3 veces</strong>.</li>
<li>En la tercera invocación, recibirá un mensaje de error que indica que <strong>se ha excedido la cuota</strong>. Esto demuestra que se ha aplicado su política de limitación de tarifas.<br><img alt="module 5 lab2 browser json response fail ratelimiting" style="width: 771.50px" src="img/305134ddeed854b6.png"></li>
</ol>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
